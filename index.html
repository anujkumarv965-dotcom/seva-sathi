<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Seva Sathi</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- PWA REQUIRED -->
  <meta name="theme-color" content="#30003C" />
  <link rel="manifest" href="manifest.json" />

  <!-- PWA ICONS -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-512.png">
</head>
<body>
  <div id="splash" class="centered">
    <div class="logo">Seva <span>Sathi</span></div>
    <div class="loader"></div>
  </div>

  <div id="app" class="hidden">
    <header>
      <button id="menuBtn" class="hamburger">☰</button>
      <h1>Seva Sathi</h1>
    </header>

    <nav id="sideMenu" class="side hidden">
      <ul>
        <li id="bookingsBtn">Bookings</li>
        <li id="settingsBtn">Settings</li>
        <li id="aboutBtn">About</li>
        <li id="logoutBtn">Logout</li>
      </ul>
    </nav>

    <main id="main">
      <section id="chooseRole" class="card">
        <h2>Sign up as</h2>
        <div class="roles">
          <button id="roleHelper" class="btn-primary">Helper</button>
          <button id="roleCustomer" class="btn-secondary">Customer</button>
        </div>
      </section>

      <section id="auth" class="card hidden">
        <h2 id="authTitle">Register</h2>
        <input id="email" type="email" placeholder="Email" />
        <input id="password" type="password" placeholder="Password" />
        <div class="row">
          <button id="emailSignUp" class="btn-primary">Sign up</button>
          <button id="emailSignIn" class="btn-outline">Sign in</button>
        </div>
        <div class="small"><a href="#" id="forgotBtn">Forgot Password</a></div>
      </section>

      <section id="profile" class="card hidden">
        <h2>Complete Helper Profile</h2>
        <label>Service provided</label>
        <select id="serviceSelect">
          <option>Cooking</option>
          <option>Cleaning</option>
          <option>Repairing</option>
          <option>Other</option>
        </select>
        <label>Full name</label>
        <input id="displayName" />
        <label>Price</label>
        <input id="price" type="number" />
        <label>Location</label>
        <input id="locationInput" />
        <label>Phone number</label>
        <input id="helperPhone" />

        <!-- Profile photo upload + preview -->
        <label>Upload profile photo</label>
        <input id="photoUpload" type="file" accept="image/*" />
        <img id="photoPreview" class="avatar" src="" alt="Profile preview" style="display:none;margin-top:8px;" />

        <button id="saveProfile" class="btn-primary">Save Profile</button>
      </section>

      <section id="helpersList" class="card hidden">
        <h2>Helpers near you</h2>

        <!-- Availability filter for customers -->
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
          <label style="font-weight:600;">Filter:</label>
          <select id="availabilityFilter" style="padding:8px;border-radius:8px;border:1px solid #ddd;">
            <option value="all">Show all</option>
            <option value="available">Show only Available</option>
          </select>
        </div>

        <div id="list"></div>
      </section>

      <section id="helperDashboard" class="card hidden">
        <h2>Helper Dashboard</h2>

        <div id="helperInfo"></div>

        <!-- Availability control (helper only) -->
        <div style="margin-top:12px;">
          <label style="font-weight:600;display:block;margin-bottom:6px;">Your availability</label>
          <div style="display:flex;gap:8px;align-items:center;">
            <button id="setAvailable" class="btn-primary" style="padding:8px 12px;">Available</button>
            <button id="setBusy" class="btn-outline" style="padding:8px 12px;">Busy</button>
            <button id="setAway" class="btn-secondary" style="padding:8px 12px;">Away</button>
            <div id="currentStatus" style="margin-left:12px;font-weight:700;"></div>
          </div>
        </div>

      </section>

      <section id="bookingsCustomer" class="card hidden">
        <h2>My Bookings</h2>
        <div id="customerBookingsList"></div>
      </section>

      <section id="bookingsHelper" class="card hidden">
        <h2>Manage Bookings</h2>
        <div id="helperBookingsList"></div>
      </section>

      <section id="settings" class="card hidden">
        <h2>Settings</h2>
        <label>Theme</label>
        <select id="themeSelect">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </section>

      <section id="about" class="card hidden">
        <h2>About</h2>
        <p>Seva Sathi v1.0 – Find & hire helpers near you.</p>
      </section>

      <!-- CHAT SECTION -->
      <section id="chatSection" class="card hidden">
        <h2>Chat</h2>
        <div id="chatUserName" style="font-weight:600;margin-bottom:8px;"></div>

        <div id="chatMessages"
          style="height:300px;overflow-y:auto;padding:10px;background:#f2f2f2;border-radius:8px;margin-bottom:10px;">
        </div>

        <div style="display:flex;gap:8px;">
          <input id="chatInput"
            placeholder="Type a message..."
            style="flex:1;padding:10px;border-radius:8px;border:1px solid #ccc;" />
          <button id="sendChatBtn" class="btn-primary" style="padding:10px 14px;">Send</button>
        </div>
      </section>

    </main>
  </div>

  <!-- Firebase libs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- Firebase Messaging (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>

  <!-- Your app -->
  <script src="app.js"></script>

  <!-- Register service workers -->
  <script>
    // Register app service worker (PWA caching and general SW)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js').catch(err => console.warn('SW reg failed', err));
    }

    // Register firebase messaging service worker (for FCM background messages)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/firebase-messaging-sw.js').catch(err => console.warn('FCM SW reg failed', err));
    }
  </script>

</body>
</html>